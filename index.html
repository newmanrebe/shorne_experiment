
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Sarah Horne Experiment</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h1>Sarah Horne Experiment</h1>
     <div id="idvalue" style="display:none">
        <form class="idform">
            <label2 for="idField" id="id">Please enter your MTurk ID</label>
            <input type="text" id="idField" class="idField">
            <input type="submit" id="sendToGoogle" value="Submit" class="sendToGoogle">
        </form>
    </div>
     <div id="money">
    </div>
    <div id="score">
    </div>
    <div id="number">
    </div>
    <div id="wrapper" style="display:none">
        <form class="form">
            <label2 for="guessField" id="guess">Answer</label>
            <input type="text" id="guessField" class="guessField">
            <input type="submit" id="subt" value="Submit" class="guessSubmit">
        </form>
    </div>
    <div id="roundformwrapper" style="display:none">
     <h2> In this next set you will need to answer:</h2>
     <h2>1 time to earn <span class="nextMonetaryVal">d</span> cents. </h2>
     <h2> Press continue to participate in this round, or press skip to move on to the next reward level. </h2>
     <form class="roundform">
            <input type="submit" id="cont" value="Continue" class="cont">
            <input type="submit" id="endr" value="End Round" class="endr">
        </form>
    </div>
<script>

collectId();
    
function collectId() {
   const idForm = document.getElementById("idvalue");
   idForm.style.display = "block";
   const idInput = document.querySelector('#idField');
   const subt = document.querySelector('#sendToGoogle');
   sendToGoogle.addEventListener('click', function(e) {
        e.preventDefault();
         const id = parseString(idInput.value);
         if (id === "") {
             alert("ID must be valid");
         }
         var jqxhr = $.ajax({
            url: url,
            method: "GET",
            dataType: "json",
            data: $form.serializeObject()
        }).success(
           idForm.style.display = "none";
        );
    });

}
    
    
let moneyVals = [10, 25, 50];
let curMoneyVal = 0;
let score = 0;
const submit = document.querySelector('#subt');
const userInput = document.querySelector('#guessField');
const p = document.createElement('p');
const ans = document.getElementById("wrapper");
const roundForm = document.getElementById("roundformwrapper");
const nextVal = document.querySelector('.nextMonetaryVal');
let numGuesses = 0;
let playGame = true;
let randomNumber = 0;

document.getElementById("money").innerHTML = `<h3>Current monetary value: ${moneyVals[curMoneyVal]} cents. </h3>`;
subt.addEventListener('click', function(e){
            e.preventDefault();
            //Grab guess from user
            const guess = parseInt(userInput.value);
            validateGuess(guess);
        });

cont.addEventListener('click', function(e){
    e.preventDefault();
    roundForm.style.display = "none";
    randomNumber = getRandomInt();
    document.getElementById("number").innerHTML = "<h1>" + randomNumber + "</h1>";
    ans.style.display = "none";
    setTimeout(function(){
      document.getElementById("number").innerHTML="";
      ans.style.display = "block";
    },2000);
   
});
    
endr.addEventListener('click', function(e){
    e.preventDefault();
    curMoneyVal++
    numGuesses = 0;
    playRound()
});  

playRound();

function shouldPlay() {
  return curMoneyVal < 3;
}

    
function newRound() {
  return numGuesses === 0;   
}

function playRound() {
    if (shouldPlay()) {
        ans.style.display = "none";
        if (newRound()) {
            roundForm.style.display = "block";
            nextVal.innerHTML = `${moneyVals[curMoneyVal]}`;
        } else {
            randomNumber = getRandomInt();
            document.getElementById("number").innerHTML = "<h1>" + randomNumber + "</h1>";
            setTimeout(function(){
              document.getElementById("number").innerHTML="";
              ans.style.display = "block";
            },2000);
        }
    } else {
      alert("Final Score: " + score.toString());
    }
    
}

function getRandomInt() {
  return Math.floor(10 + (Math.random() * 89));
}

function reverseString(str) {
    return str.split("").reverse().join("");
}

function validateGuess(guess){
    if (isNaN(guess)){
        alert('Please enter a valid number');
    } else {
        checkGuess(guess);
    }
}

function checkGuess(guess){
  if (guess.toString() === reverseString(randomNumber.toString())){
       numGuesses++;
       score += moneyVals[curMoneyVal];
  } else {
    curMoneyVal++;
    numGuesses = 0;
  }
  if (numGuesses === 16) {
    numGuesses = 0;
    curMoneyVal++;
  }
  userInput.value = '';
  document.getElementById("score").innerHTML = `<h3>Money earned: ${score} cents. </h3>`
  document.getElementById("money").innerHTML = `<h3>Current monetary value: ${moneyVals[curMoneyVal]} cents. </h3>`;
  playRound();
}

</script>
</body>
</html>
