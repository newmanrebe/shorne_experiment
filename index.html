
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Sarah Horne Experiment</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h1>Sarah Horne Experiment</h1>
     <div id="idvalue" style="display:none">
        <form class="idform">
            <label2 for="idField" id="idPrompt">Please enter your MTurk ID</label>
            <input type="text" id="idField" class="idField">
            <input type="submit" id="submitId" value="Submit" class="submitId">
        </form>
    </div>
     <div id="money">
    </div>
    <div id="score">
    </div>
    <div id="number">
    </div>
    <div id="wrapper" style="display:none">
        <form class="form">
            <label2 for="guessField" id="guess">Answer</label>
            <input type="text" id="guessField" class="guessField">
            <input type="submit" id="subt" value="Submit" class="guessSubmit">
        </form>
    </div>
    <div id="roundformwrapper" style="display:none">
     <h2> In this next set you will need to answer:</h2>
     <h2>1 time to earn <span class="nextMonetaryVal">d</span> cents. </h2>
     <h2> Press continue to participate in this round, or press skip to move on to the next reward level. </h2>
     <form class="roundform">
            <input type="submit" id="cont" value="Continue" class="cont">
            <input type="submit" id="endr" value="End Round" class="endr">
        </form>
    </div>
<script>



let moneyVals = [10, 25, 50];
let curMoneyVal = 0;
let score = 0;
const submit = document.querySelector('#subt');
const userInput = document.querySelector('#guessField');
const p = document.createElement('p');
const ans = document.getElementById("wrapper");
const roundForm = document.getElementById("roundformwrapper");
const idForm = document.getElementById("idvalue");
const idInput = document.querySelector('#idField');
const nextVal = document.querySelector('.nextMonetaryVal');
  
let idVal = 0;
let numGuesses = 0;
let playGame = true;
let randomNumber = 0;

function collectId() {
    idForm.style.display = "block";
    submitId.addEventListener('click', function(e) {
           e.preventDefault();
           idVal = parseInt(idInput.value);
           alert('Id:' + idVal.toString());
    });
}

subt.addEventListener('click', function(e){
            e.preventDefault();
            //Grab guess from user
            const guess = parseInt(userInput.value);
            validateGuess(guess);
        });

cont.addEventListener('click', function(e){
    e.preventDefault();
    roundForm.style.display = "none";
    randomNumber = getRandomInt();
    document.getElementById("money").innerHTML = `<h3>Current monetary value: ${moneyVals[curMoneyVal]} cents. </h3>`;
    document.getElementById("number").innerHTML = "<h1>" + randomNumber + "</h1>";
    ans.style.display = "none";
    setTimeout(function(){
      document.getElementById("number").innerHTML="";
      ans.style.display = "block";
    },2000);

});

endr.addEventListener('click', function(e){
    e.preventDefault();
    curMoneyVal++
    numGuesses = 0;
    playRound()
});  
    
collectId();
    
function shouldPlay() {
  return curMoneyVal < 3;
}

    
function newRound() {
  return numGuesses === 0;   
}

function playRound() {
    idForm.style.display = "none";
    if (shouldPlay()) {
        ans.style.display = "none";
        if (newRound()) {
            roundForm.style.display = "block";
            nextVal.innerHTML = `${moneyVals[curMoneyVal]}`;
        } else {
            randomNumber = getRandomInt();
            document.getElementById("money").innerHTML = `<h3>Current monetary value: ${moneyVals[curMoneyVal]} cents. </h3>`
            document.getElementById("number").innerHTML = "<h1>" + randomNumber + "</h1>";
            setTimeout(function(){
              document.getElementById("number").innerHTML="";
              ans.style.display = "block";
            },2000);
        }
    } else {
      postToGoogle();
    }
    
}

function getRandomInt() {
  return Math.floor(10 + (Math.random() * 89));
}

function reverseString(str) {
    return str.split("").reverse().join("");
}

function validateGuess(guess){
    if (isNaN(guess)){
        alert('Please enter a valid number');
    } else {
        checkGuess(guess);
    }
}

function checkGuess(guess){
  if (guess.toString() === reverseString(randomNumber.toString())){
       numGuesses++;
       score += moneyVals[curMoneyVal];
  } else {
    curMoneyVal++;
    numGuesses = 0;
  }
  if (numGuesses === 16) {
    numGuesses = 0;
    curMoneyVal++;
  }
  userInput.value = '';
  document.getElementById("score").innerHTML = `<h3>Money earned: ${score/100}. </h3>`
  document.getElementById("money").innerHTML = `<h3>Current monetary value: ${moneyVals[curMoneyVal]} cents. </h3>`;
  playRound();
}
   
function PostToGoogle(){
    $.ajax({
        url = "https://docs.google.com/spreadsheets/d/1ONz_j4es77MfOSf9DEu-4NZkDbxGFMh-qjbQlKmE-k8/edit#gid=0",
        data: {"idField": idVal, "score": score/100},
        type: "POST",
        dataType: "xml",
        success: function(d){
           alert('Thanks for playing!');
        },
        error: function(x,y,z){
            //show your error message
            alert('Error recording response');
       }
    });
}

</script>
</body>
</html>
